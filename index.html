<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Eye Visualization</title>
    <!-- Bulma Style Sheet -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.2/css/bulma.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bulma-extensions@6.2.7/dist/js/bulma-extensions.min.js"></script>
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
        integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v4.js"></script>
    <!-- Load ChartsJS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.2/dist/Chart.min.js"></script>
    <!-- Load heatmap.js -->
    <script src='./JS/heatmap.min.js'></script>
    <!-- data -->
    <script src="Data/Others/participant_data.js"></script>
    <script type="text/javascript" src="Data/json_data/p1/p1treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p2/p2treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p3/p3treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p4/p4treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p5/p5treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p6/p6treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p7/p7treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p10/p10treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p11/p11treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p12/p12treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p13/p13treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p14/p14treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p15/p15treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p16/p16treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p17/p17treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p18/p18treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p19/p19treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p20/p20treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p21/p21treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p23/p23treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p24/p24treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p25/p25treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p27/p27treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p28/p28treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p30/p30treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p31/p31treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p32/p32treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p33/p33treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p34/p34treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p35/p35treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p36/p36treeFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p1/p1graphFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p2/p2graphFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p3/p3graphFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p4/p4graphFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p5/p5graphFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p6/p6graphFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p7/p7graphFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p10/p10graphFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p11/p11graphFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p12/p12graphFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p13/p13graphFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p14/p14graphFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p15/p15graphFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p16/p16graphFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p17/p17graphFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p18/p18graphFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p19/p19graphFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p20/p20graphFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p21/p21graphFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p23/p23graphFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p24/p24graphFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p25/p25graphFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p27/p27graphFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p28/p28graphFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p30/p30graphFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p31/p31graphFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p32/p32graphFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p33/p33graphFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p34/p34graphFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p35/p35graphFXD.json"></script>
    <script type="text/javascript" src="Data/json_data/p36/p36graphFXD.json"></script>
    <script src="Data/combined_data/generalTree.js"></script>
    <script src="Data/combined_data/generalGraph.js"></script>
    <script src="Data/combined_data/expertTree.js"></script>
    <script src="Data/combined_data/expertGraph.js"></script>

</head>

<body>
    <div class="columns">
        <!-- This section is the context menu HTML -->
        <div class="column is-2 dark">
            <div class="context-menu hero is-fullheight">
                <aside class="menu">
                    <p class="menu-label">
                        Eye Tracking Visualization
                    </p>
                    <ul class="menu-list">
                        <li><a onclick="load('Fixation_Visualization')">Fixation Comparison</a></li>
                        <li><a onclick="load('Convex_Visualization')">Convex Hull Comparison</a></li>
                    </ul>
                    <p class="menu-label">
                        Session Visualization
                    </p>
                    <ul class="menu-list">
                        <li><a onclick="load('Session_Overview')">Overview</a></li>
                        <li><a onclick="load('Time_Comparison')">Time Comparison</a></li>
                        <li><a onclick="load('Completion_Comparison')">Completion Comparison</a></li>
                    </ul>
                </aside>
            </div>
        </div>
        <!-- End of context menu HTML -->
        <!-- This section is the Visualization Code for every visualization image we are creating -->
        <div class="column">
            <div id="Fixation_Visualization" class="start">
                <div class="title">Fixation Visualization</div>
                <div>
                    <label class="selector_label">Ontology:</label>
                    <button id="Fixation_Visualization_General" class="button comparison_button_selected"
                            onclick="selectOntology(1)"><i class="fas fa-info-circle"></i> &nbsp;
                        General
                    </button>
                    <button id="Fixation_Visualization_Expert" class="button"
                            onclick="selectOntology(2)"><i class="fas fa-atlas"></i> &nbsp;
                        Expert
                    </button>
                    <!--  slider -->
                    <br/><br/>
                    <div class = "slidecontainer">
                        <p class="subtitle">Pupil Dilation Slider</p>
                        <input type = "range", min = "2", max = "4", value = "2", step = ".2" class = "slider", id = "rangeSlider", onchange="refreshFixationVisualization(this.value)">
                    </div> 
                    <div id = "output" class="subtitle"> </div>
                </div>
                <br>
                <heatmapSection>
                    <div id='treeHeatmap' class="heatmap" style="width: 800px">
                        <center class="label">Tree</center>
                        <img src="./Assets/monitor.png"></img>
                    </div>
                    <div class = "tooltip" id="treeTooltip" style="display: inline-block"></div>
                    <div
                        id='graphHeatmap' class="heatmap" style="width: 800px">
                        <center class="label">Graph</center>
                        <img src="./Assets/monitor.png"></img>
                    </div>
                    <div class = "tooltip" id="graphTooltip" style="display: inline-block"></div>
                </heatmapSection>
 
            </div>
            <div id="Convex_Visualization" class="default">
                <div class="title">Convex Hull Comparison</div>
                <label class="selector_label">Ontology:</label>
                <button id="ConvexHull_Comparison_General" class="button comparison_button_selected"
                    onclick="changeConvexHullOntology(1)">
                    <i class="fas fa-info-circle"></i> &nbsp;
                    General
                </button>
                <button id="ConvexHull_Comparison_Expert" class="button" onclick="changeConvexHullOntology(2)">
                    <i class="fas fa-atlas"></i>&nbsp;
                    Expert
                </button>
                <div class="tile is-vertical is-ancestor">
                    <div class="tile is-parent">
                        <div id="convexhull_tree_visualization_container" class="tile notification juicy space">

                            <div id="convexhull_tree_visualization"></div>
                        </div>
                        <div id="convexhull_graph_visualization_container" class="tile notification juicy space">

                            <div id="convexhull_graph_visualization"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="Time_Visualization" class="default"> Time Visualization </div>
            <div id="Session_Overview" class="default">
                <div class="title">Session Overview</div>
                <div class="tile is-vertical is-ancestor">
                    <div class="tile is-parent">
                        <div id="session_overview_visualization_container" class="tile notification juicy space">
                            <canvas id="session_overview_visualization_time" class="tile_canvas"></canvas>
                        </div>
                        <div id="session_overview_visualization_container" class="tile notification juicy space">
                            <canvas id="session_overview_visualization_success" class="tile_canvas"></canvas>
                        </div>
                    </div>
                </div>

            </div>
            <div id="Time_Comparison" class="default">
                <div class="title">Time Comparison Visualization</div>
                <div>
                    <label class="selector_label">Ontology:</label>
                    <button id="Time_Comparison_General" class="button comparison_button_selected"
                        onclick="refreshTimeComparisonChart(1)"><i class="fas fa-info-circle"></i> &nbsp;
                        General
                    </button>
                    <button id="Time_Comparison_Expert" class="button" onclick="refreshTimeComparisonChart(2)"><i
                            class="fas fa-atlas"></i>&nbsp;
                        Expert
                    </button>
                    <div id="time_comparison_visualization_container">
                        <canvas id="time_comparison_visualization" class="comparison_canvas"></canvas>
                    </div>
                </div>
            </div>
            <div id="Completion_Comparison" class="default">
                <div class="title">Completion Comparison Visualization</div>
                <div>
                    <label class="selector_label">Ontology:</label>
                    <button id="Completion_Comparison_General" class="button comparison_button_selected"
                        onclick="refreshCompletionComparisonChart(1)"><i class="fas fa-info-circle"></i> &nbsp;
                        General
                    </button>
                    <button id="Completion_Comparison_Expert" class="button"
                        onclick="refreshCompletionComparisonChart(2)"><i class="fas fa-atlas"></i>&nbsp;
                        Expert
                    </button>
                    <div id="completion_comparison_visualization_container">
                        <canvas id="completion_comparison_visualization" class="comparison_canvas"></canvas>
                    </div>
                </div>
            </div>
        
        </div>
        <!-- End of Visualization Section -->
    </div>


    <!-- Javascript Section -->
    <!-- Embedded Javascript for the context menu-->
    <script>
        function load(id) {
            document.getElementById("Fixation_Visualization").style.display = "none";
            document.getElementById("Convex_Visualization").style.display = "none";
            document.getElementById("Session_Overview").style.display = "none";
            document.getElementById("Time_Comparison").style.display = "none";
            document.getElementById("Completion_Comparison").style.display = "none";
            document.getElementById(id).style.display = "block";
        }
    </script>

    <!-- Embedded Javascript for the Fixation_Visualization-->
    <script>
        var isGeneral = true;
        var ontology = 1;


        var treeInstance = h337.create({
            container: document.getElementById('treeHeatmap')
        });
        var graphInstance = h337.create({
            container: document.getElementById('graphHeatmap')
        });

        refreshFixationVisualization(ontology);

        // slider code

        var slider = document.getElementById("rangeSlider");
        var output = document.getElementById("output");

        // Update the current slider value (each time you drag the slider handle)
        slider.oninput = function() {
            output.innerHTML = "Pupil Dilation: " + this.value + " +/- .1" + " mm";
            refreshFixationVisualization(ontology, parseFloat(this.value) ); //passes in pupil dilation and ontology
        }
        
        // slider code end

        function selectOntology(value){
            ontology = value;
            refreshFixationVisualization(ontology);
        }
        
        function refreshFixationVisualization(value, pupilSize) {
            if(pupilSize == undefined){
                fixationVisualizationSelectorValue = value;
                var general = document.getElementById("Fixation_Visualization_General");
                var expert = document.getElementById("Fixation_Visualization_Expert");
                general.className = "button";
                expert.className = "button";
                switch (value) {
                    case 1:
                        general.className = "button comparison_button_selected";
                        treeInstance.setData(getTotalFixationData(generalTreeFXD));
                        graphInstance.setData(getTotalFixationData(generalGraphFXD));
                        isGeneral = true;
                        break;
                    case 2:
                        expert.className = "button comparison_button_selected";
                        treeInstance.setData(getTotalFixationData(expertTreeFXD));
                        graphInstance.setData(getTotalFixationData(expertGraphFXD));
                        isGeneral = false;
                        break;
                }
            }
            else{
                fixationVisualizationSelectorValue = value;
                var general = document.getElementById("Fixation_Visualization_General");
                var expert = document.getElementById("Fixation_Visualization_Expert");
                general.className = "button";
                expert.className = "button";
                switch (value) {
                    case 1:
                        general.className = "button comparison_button_selected";
                        treeInstance.setData(getTotalFixationData(generalTreeFXD, pupilSize));
                        graphInstance.setData(getTotalFixationData(generalGraphFXD, pupilSize));
                        isGeneral = true;
                        break;
                    case 2:
                        expert.className = "button comparison_button_selected";
                        treeInstance.setData(getTotalFixationData(expertTreeFXD, pupilSize));
                        graphInstance.setData(getTotalFixationData(expertGraphFXD, pupilSize));
                        isGeneral = false;
                        break;
                }
            }
            
        }

        function getTotalFixationData(heatmapList, pupilSize) {
            parseFloat(pupilSize);
            if(pupilSize == undefined){
                var heatmapPoints = [];
                var heatmapMax = 0;

                heatmapList.forEach(number => {
                    number.forEach(element => {
                        heatmapMax = Math.max(heatmapMax, element.Duration);
                        var heatmapPoint = {
                            x: element.ScreenX/2.19375 + 36,
                            y: element.ScreenY/2.19375 + 68,
                            value: element.Duration,
                            radius: element.Duration / 80
                        };
                        heatmapPoints.push(heatmapPoint)
                    })
                });

                var heatmapData = {
                    max: heatmapMax,
                    data: heatmapPoints
                };

                return heatmapData;
            }
            else{ //using pupilSize
                var heatmapPoints = [];
                var heatmapMax = 0;
                var pupilUpperBound = pupilSize + .1;
                var pupilLowerBound = pupilSize - .1;
                heatmapList.forEach(number => {
                    number.forEach(element => {
                        heatmapMax = Math.max(heatmapMax, element.Duration);
                        if( (element.LeftPupil >= pupilLowerBound && element.LeftPupil <= pupilUpperBound  ) || (element.RightPupil >= pupilLowerBound && element.RightPupil <= pupilUpperBound) ){ //only accept points within pupil dilation range
                            var heatmapPoint = {
                            x: element.ScreenX/2.19375 + 36,
                            y: element.ScreenY/2.19375 + 68,
                            value: element.Duration,
                            radius: element.Duration / 80
                            };
                            heatmapPoints.push(heatmapPoint)
                        }
                        
                    })
                });

                var heatmapData = {
                    max: heatmapMax,
                    data: heatmapPoints
                };
                return heatmapData;
            }
            
        }

        // hover info
        var treeheatmapWrapper = document.getElementById("treeHeatmap");
        var grapheatmapWrapper = document.getElementById("graphHeatmap");
        var treeTooltip = document.getElementById("treeTooltip");
        var graphTooltip = document.getElementById("graphTooltip");

        function updateTreeTooltip(x, y, value) {
            // + 15 for distance to cursor
            var transl = 'translate(' + (x + 250) + 'px, ' + (y + 100) + 'px)';
            treeTooltip.style.webkitTransform = transl;
            treeTooltip.innerHTML = "Total fixation value: " + value;
            // treeTooltip.innerHTML = "left pupil: " + value[0] + ", " + "right pupil: " + value[1];
        
        };

        function updateGraphTooltip(x, y, value) {
            // + 15 for distance to cursor
            var transl = 'translate(' + (x + 1050) + 'px, ' + (y + 100) + 'px)';
            graphTooltip.style.webkitTransform = transl;
            // graphTooltip.innerHTML = "left pupil: " + value[0] + ", " + "right pupil: " + value[1];
            graphTooltip.innerHTML = "Total fixation value: " + value;
        };

        treeheatmapWrapper.onmousemove = function(ev){
            var x = ev.layerX;
            var y = ev.layerY;
            // var value;
            var value = treeInstance.getValueAt({
                x: x,
                y: y
            });
            
            treeTooltip.style.display = 'block';
            updateTreeTooltip(x, y, value);
        };

        treeheatmapWrapper.onmouseout = function(){
            treeTooltip.style.display = 'none'
        }

        grapheatmapWrapper.onmousemove = function(ev){
            var x = ev.layerX;
            var y = ev.layerY;
            // var value;
            var value = graphInstance.getValueAt({
                x: x,
                y: y
            });
            
            graphTooltip.style.display = 'block';
            updateGraphTooltip(x, y, value);
        }

        grapheatmapWrapper.onmouseout = function(){
            graphTooltip.style.display = 'none'
        }

    </script>
    <!-- Embedded Javascript for Participant_Overview-->
    <script>
        // Locating Session Visualization Overview canvas tiles
        var generalSessionTime = document.getElementById("General_Session_Time_Average");
        var generalSessionSuccess = document.getElementById("General_Session_Success_Average");
        var expertSessionTime = document.getElementById("Expert_Session_Time_Average");
        var expertSessionSuccess = document.getElementById("Expert_Session_Success_Average");
        // Set current comparison to tree (Tree = 1 Graph = 2)
        var sessionOverviewComparisonType = 1;
        // Create the Radar Visualization on the Session Comparison Overview
        refreshSessionOverviewChart();
        // Title is the Title of the visualization
        // canvasElement is the element on the DOM we are drawing onto
        // The participant data
        // Type is a bool value -> true = Time | false = Success
        function generateNewRadarChart(title, canvasElement, data, type) {
            var labels = []; // Participants
            var values = []; // Data Value
            var timeAverage = 0;
            var successAverage = 0;
            // Data Processing (filtering for time or success percentage)
            data.forEach(element => {
                labels.push(element.ID);
                if (type) {
                    values.push(element.Time_On_Task)
                } else {
                    values.push(element.Task_Success * 100)
                }
                timeAverage += element.Time_On_Task;
                successAverage += (element.Task_Success * 100);
            });
            timeAverage = timeAverage / data.length;
            successAverage = successAverage / data.length;
            // Afix the average value onto the title
            title = title + ": " + (type ? timeAverage.toFixed(2) + " min" : successAverage.toFixed(2) + "%");
            new Chart(canvasElement, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: type ? "rgba(165, 192, 238, 0.5)" : "rgba(251, 197, 236, 0.5)",
                        fillOpacity: .5,
                        borderWidth: 1
                    }]
                },
                options: {
                    scale: {
                        pointLabels: {
                            fontSize: 15,
                            fontColor: "#FFFFFF"
                        },
                        ticks: {
                            suggestedMin: 0,
                            suggestedMax: type ? 50 : 100
                        }
                    },
                    legend: {
                        display: false
                    },
                    title: {
                        display: true,
                        text: title,
                        fontSize: 30,
                        fontColor: "#FFFFFF",
                        fontStyle: "bolder",
                        padding: 2
                    }
                }
            });

        }

        function destroySessionOverviewCanvas(holder, containerName, canvasName) {
            var container = document.getElementById(containerName);
            container.removeChild(holder);
            var canvas = document.createElement('canvas');
            canvas.id = canvasName;
            canvas.className = "tile_canvas";
            container.appendChild(canvas);
        }

        function refreshSessionOverviewChart() {
            destroySessionOverviewCanvas(generalSessionTime, "General_Session_Time_Average_Container",
                "General_Session_Time_Average");
            destroySessionOverviewCanvas(expertSessionTime, "Expert_Session_Time_Average_Container",
                "Expert_Session_Time_Average");
            destroySessionOverviewCanvas(generalSessionSuccess, "General_Session_Success_Average_Container",
                "General_Session_Success_Average");
            destroySessionOverviewCanvas(expertSessionSuccess, "Expert_Session_Success_Average_Container",
                "Expert_Session_Success_Average");
            generalSessionTime = document.getElementById("General_Session_Time_Average");
            generalSessionSuccess = document.getElementById("General_Session_Success_Average");
            expertSessionTime = document.getElementById("Expert_Session_Time_Average");
            expertSessionSuccess = document.getElementById("Expert_Session_Success_Average");
            generateNewRadarChart("General Time Average", generalSessionTime, participants
                .filter((e) => {
                    return e.Ontologies === 1 && e.Visualization === sessionOverviewComparisonType;
                }), true);
            generateNewRadarChart("Expert Time Average", expertSessionTime, participants
                .filter((e) => {
                    return e.Ontologies === 2 && e.Visualization === sessionOverviewComparisonType;
                }), true);
            generateNewRadarChart("General Success Average", generalSessionSuccess,
                participants.filter((e) => {
                    return e.Ontologies === 1 && e.Visualization === sessionOverviewComparisonType;
                }), false);
            generateNewRadarChart("Expert Success Average", expertSessionSuccess,
                participants.filter((e) => {
                    return e.Ontologies === 2 && e.Visualization === sessionOverviewComparisonType;
                }), false);
        }

        function switchSessionOverview(type) {
            var tree = document.getElementById("Session_Comparison_Tree");
            var graph = document.getElementById("Session_Comparison_Graph");
            tree.className = "button space";
            graph.className = "button space"
            if (type === "Session_Comparison_Tree") {
                sessionOverviewComparisonType = 1;
                tree.className += " button_selected";
            } else {
                sessionOverviewComparisonType = 2;
                graph.className += " button_selected";
            }
            refreshSessionOverviewChart();
        }
    </script>
    <!-- Embedded Javascript for Session_Overview -->
    <script>
        var session_overview_visualization_time = document.getElementById("session_overview_visualization_time");
        var session_overview_visualization_success = document.getElementById("session_overview_visualization_success");
        createSessionOverviewVisualization();

        function createSessionOverviewVisualization() {
            var generalTree = participants.filter((e) => {
                return e.Ontologies === 1 && e.Visualization === 1;
            });
            var generalGraph = participants.filter((e) => {
                return e.Ontologies === 1 && e.Visualization === 2;
            });
            var expertTree = participants.filter((e) => {
                return e.Ontologies === 2 && e.Visualization === 1;
            });
            var expertGraph = participants.filter((e) => {
                return e.Ontologies === 2 && e.Visualization === 2;
            });

            var gTreeTime = 0;
            var gGraphTime = 0;
            var gTreeSuccess = 0;
            var gGraphSuccess = 0;
            var eTreeTime = 0;
            var eGraphTime = 0;
            var eTreeSuccess = 0;
            var eGraphSucess = 0;
            var labels = ["Tree", "Graph"];
            generalTree.forEach((e) => {
                gTreeTime += e.Time_On_Task;
                gTreeSuccess += (e.Task_Success * 100)
            })
            generalGraph.forEach((e) => {
                gGraphTime += e.Time_On_Task;
                gGraphSuccess += (e.Task_Success * 100)
            })
            expertTree.forEach((e) => {
                eTreeTime += e.Time_On_Task;
                eTreeSuccess += (e.Task_Success * 100);
            })
            expertGraph.forEach((e) => {
                eGraphTime += e.Time_On_Task;
                eGraphSucess += (e.Task_Success * 100);
            })
            gTreeTime /= generalTree.length;
            gGraphTime /= generalGraph.length;
            gTreeSuccess /= generalTree.length;
            gGraphSuccess /= generalGraph.length;
            eTreeTime /= expertTree.length;
            eGraphTime /= expertGraph.length;
            eTreeSuccess /= expertTree.length;
            eGraphSucess /= expertGraph.length;
            var generalDataSet = [{
                label: "General",
                backgroundColor: "blue",
                data: [gTreeTime, eTreeTime]
            }, {
                label: "Expert",
                backgroundColor: "red",
                data: [gGraphTime, eGraphTime]
            }];
            var expertDataSet = [{
                label: "General",
                backgroundColor: "blue",
                data: [gTreeSuccess, gGraphSuccess]
            }, {
                label: "Expert",
                backgroundColor: "red",
                data: [eTreeSuccess, eGraphSucess]
            }]


            new Chart(session_overview_visualization_time, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: generalDataSet
                },
                options: {
                    legend: {
                        labels: {
                            fontColor: 'white'
                        }
                    },
                    scales: {
                        yAxes: [{
                            ticks: {
                                fontColor: 'white',
                                beginAtZero: true
                            }
                        }],
                        xAxes: [{
                            ticks: {
                                fontColor: 'white'
                            }
                        }]
                    },
                    title: {
                        display: true,
                        text: "Time",
                        fontSize: 30,
                        fontColor: "#FFFFFF",
                        fontStyle: "bolder",
                        padding: 2
                    }
                }
            })
            new Chart(session_overview_visualization_success, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: expertDataSet
                },
                options: {
                    legend: {
                        labels: {
                            fontColor: 'white'
                        }
                    },
                    scales: {
                        yAxes: [{
                            ticks: {
                                fontColor: 'white',
                                beginAtZero: true
                            }
                        }],
                        xAxes: [{
                            ticks: {
                                fontColor: 'white'
                            }
                        }]
                    },
                    title: {
                        display: true,
                        text: "Completion",
                        fontSize: 30,
                        fontColor: "#FFFFFF",
                        fontStyle: "bolder",
                        padding: 2
                    }
                }
            })
        }
    </script>
    <!-- Embedded Javascript for Time_Comparison -->
    <script>
        var timeComparisonVisualizaton = document.getElementById("time_comparison_visualization");
        // value 1 = General | value 2 = Expert
        var timeVisualizationSelectorValue = 1;
        createTimeComparisonChart();
        Chart.pluginService.register({
            afterDraw: function (chart) {
                if (typeof chart.config.options.lineAt != 'undefined') {
                    var treeValue = chart.config.options.lineAt.treeValue;
                    var treeColor = chart.config.options.lineAt.treeColor;
                    var graphValue = chart.config.options.lineAt.graphValue;
                    var graphColor = chart.config.options.lineAt.graphColor;
                    var ctxPlugin = chart.chart.ctx;
                    var xAxe = chart.scales[chart.config.options.scales.xAxes[0].id];
                    var yAxe = chart.scales[chart.config.options.scales.yAxes[0].id];

                    if (yAxe.min != 0) return;

                    ctxPlugin.strokeStyle = treeColor;
                    ctxPlugin.beginPath();
                    var lineAt = (treeValue - yAxe.min) * (100 / yAxe.max);
                    lineAt = (100 - lineAt) / 100 * (yAxe.height) + yAxe.top;
                    ctxPlugin.moveTo(xAxe.left, lineAt);
                    ctxPlugin.lineTo(xAxe.right, lineAt);
                    ctxPlugin.stroke();

                    ctxPlugin.strokeStyle = graphColor;
                    ctxPlugin.beginPath();
                    var lineAt = (graphValue - yAxe.min) * (100 / yAxe.max);
                    lineAt = (100 - lineAt) / 100 * (yAxe.height) + yAxe.top;
                    ctxPlugin.moveTo(xAxe.left, lineAt);
                    ctxPlugin.lineTo(xAxe.right, lineAt);
                    ctxPlugin.stroke();

                }
            }
        })

        function createTimeComparisonChart() {
            var labels = [];
            var values = [{
                label: "Tree",
                backgroundColor: "Red",
                data: []

            }, {
                label: "Graph",
                backgroundColor: "Blue",
                data: []
            }];
            var treeTimeAverage = 0;
            var graphTimeAverage = 0;
            var treeCounter = 0;
            var graphCounter = 0
            participants.forEach((participant) => {
                var ontologySearchValue = timeVisualizationSelectorValue;
                if (participant.Ontologies === ontologySearchValue) {
                    labels.push(participant.ID);
                    if (participant.Visualization === 1) {
                        treeTimeAverage += participant.Time_On_Task;
                        values[0].data.push(participant.Time_On_Task);
                        values[1].data.push(0);
                        treeCounter++;
                    } else {
                        graphTimeAverage += participant.Time_On_Task;
                        values[0].data.push(0);
                        values[1].data.push(participant.Time_On_Task);
                        graphCounter++;
                    }
                }

            });
            treeTimeAverage = treeTimeAverage / treeCounter;
            graphTimeAverage = graphTimeAverage / graphCounter;
            new Chart(timeComparisonVisualizaton, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: values,
                    options: {
                        barValueSpacing: 5,
                        scales: {
                            yAxes: [{
                                ticks: {
                                    min: 0,
                                }
                            }]
                        }
                    }
                },
                options: {
                    lineAt: {
                        treeValue: treeTimeAverage,
                        treeColor: "Red",
                        graphValue: graphTimeAverage,
                        graphColor: "Blue"
                    }
                }
            });
        }

        function refreshTimeComparisonChart(value) {
            timeVisualizationSelectorValue = value;
            var general = document.getElementById("Time_Comparison_General");
            var expert = document.getElementById("Time_Comparison_Expert");
            var container = document.getElementById("time_comparison_visualization_container");
            general.className = "button";
            expert.className = "button";
            switch (value) {
                case 1:
                    general.className = "button comparison_button_selected";
                    break;
                case 2:
                    expert.className = "button comparison_button_selected";
                    break;
            }
            container.removeChild(timeComparisonVisualizaton);
            var canvas = document.createElement('canvas');
            canvas.id = "time_comparison_visualization";
            canvas.className = "comparison_canvas";
            container.appendChild(canvas);
            timeComparisonVisualizaton = document.getElementById("time_comparison_visualization");
            createTimeComparisonChart();
        }
    </script>
    <!-- Embedded Javascript for Success_Comparison -->
    <script>
        var completionComparisionVisualization = document.getElementById("completion_comparison_visualization");
        // value 1 = General | value 2 = Expert
        var completionVisualizationSelectorValue = 1;
        createCompletionComparisonChart();

        function createCompletionComparisonChart() {
            var labels = [];
            var values = [{
                label: "Tree",
                backgroundColor: "Red",
                data: []
            }, {
                label: "Graph",
                backgroundColor: "Blue",
                data: []
            }];
            var treeSuccessAverage = 0;
            var graphSuccessAverage = 0;
            var treeCounter = 0;
            var graphCounter = 0
            participants.forEach((participant) => {
                // Show Tree and Graph Comparison
                var ontologySearchValue = completionVisualizationSelectorValue;
                if (participant.Ontologies === ontologySearchValue) {
                    labels.push(participant.ID);
                    if (participant.Visualization === 1) {
                        treeSuccessAverage += (participant.Task_Success * 100);
                        treeCounter++;
                        values[0].data.push(participant.Task_Success * 100);
                        values[1].data.push(0);
                    } else {
                        graphSuccessAverage += (participant.Task_Success * 100);
                        graphCounter++;
                        values[0].data.push(0);
                        values[1].data.push(participant.Task_Success * 100);
                    }
                }
            });
            treeSuccessAverage = treeSuccessAverage / treeCounter;
            graphSuccessAverage = graphSuccessAverage / graphCounter;
            new Chart(completionComparisionVisualization, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: values,
                    options: {
                        barValueSpacing: 5,
                        scales: {
                            yAxes: [{
                                ticks: {
                                    max: 100,
                                    min: 0,
                                    stepSize: 10
                                }
                            }]
                        }
                    }
                },
                options: {
                    lineAt: {
                        treeValue: treeSuccessAverage,
                        treeColor: "Red",
                        graphValue: graphSuccessAverage,
                        graphColor: "Blue"
                    }
                }

            });

        }

        function refreshCompletionComparisonChart(value) {
            completionVisualizationSelectorValue = value;
            var general = document.getElementById("Completion_Comparison_General");
            var expert = document.getElementById("Completion_Comparison_Expert");
            var container = document.getElementById("completion_comparison_visualization_container");
            general.className = "button";
            expert.className = "button";
            switch (value) {
                case 1:
                    general.className = "button comparison_button_selected";
                    break;
                case 2:
                    expert.className = "button comparison_button_selected";
                    break;
            }
            container.removeChild(completionComparisionVisualization);
            var canvas = document.createElement('canvas');
            canvas.id = "completion_comparison_visualization";
            canvas.className = "comparison_canvas";
            container.appendChild(canvas);
            completionComparisionVisualization = document.getElementById("completion_comparison_visualization");
            createCompletionComparisonChart();
        }
    </script>
    <!-- Embedded Javascript for Convex_Visualization -->
    <script>
        // Holds selected Ontology value 1 = General | value 2 = Expert
        var ConvexHullOntologySelected = 1;
        // Ignore 8,9,22,26,29
        const CVtreeFXDvis = [treeFXD1, treeFXD2, treeFXD3, treeFXD4, treeFXD5, treeFXD6, treeFXD7,
            undefined, undefined, treeFXD10, treeFXD11, treeFXD12, treeFXD13, treeFXD14, treeFXD15, treeFXD16,
            treeFXD17, treeFXD18, treeFXD19, treeFXD20, treeFXD21, undefined, treeFXD23,
            treeFXD24, treeFXD25, undefined, treeFXD27, treeFXD28, undefined, treeFXD30,
            treeFXD31, treeFXD32, treeFXD33, treeFXD34, treeFXD35, treeFXD36
        ];
        const CVgraphFXDvis = [graphFXD1, graphFXD2, graphFXD3, graphFXD4, graphFXD5, graphFXD6, graphFXD7,
            undefined, undefined, graphFXD10, graphFXD11, graphFXD12, graphFXD13, graphFXD14, graphFXD15, graphFXD16,
            graphFXD17, graphFXD18, graphFXD19, graphFXD20, graphFXD21, undefined, graphFXD23,
            graphFXD24, graphFXD25, undefined, graphFXD27, graphFXD28, undefined, graphFXD30,
            graphFXD31, graphFXD32, graphFXD33, graphFXD34, graphFXD35, graphFXD36
        ];
        var treeGeneralConvexData = [];
        var treeExpertConvexData = [];
        var graphGeneralConvexData = [];
        var graphExpertConvexData = [];
        participants.forEach((participant) => {
            var numberPattern = /\d+/g;
            var index = participant.ID.match(numberPattern)[0]; // Get ID number
            if (CVtreeFXDvis[index] !== undefined) {
                // General Tree
                if (participant.Ontologies === 1 && participant.Visualization === 1) {
                    treeGeneralConvexData.push(CVtreeFXDvis[index]);
                }
                // Expert Tree
                else if (participant.Ontologies === 2 && participant.Visualization === 1) {
                    treeExpertConvexData.push(CVtreeFXDvis[index]);
                }
                // General Graph
                else if (participant.Ontologies === 1 && participant.Visualization === 2) {
                    graphGeneralConvexData.push(CVgraphFXDvis[index]);
                }
                // Expert Graph
                else {
                    graphExpertConvexData.push(CVgraphFXDvis[index]);
                }
            }
        })
        resetConvexHullVisualization();

        function changeConvexHullOntology(value) {
            ConvexHullOntologySelected = value;
            var general = document.getElementById("ConvexHull_Comparison_General");
            var expert = document.getElementById("ConvexHull_Comparison_Expert");
            general.className = "button";
            expert.className = "button";
            switch (value) {
                case 1:
                    general.className = "button comparison_button_selected";
                    break;
                case 2:
                    expert.className = "button comparison_button_selected";
                    break;
            }
            resetConvexHullVisualization();
        }

        function resetConvexHullVisualization() {
            d3.select("#convexhull_tree_visualization").remove();
            // Refresh Tree
            d3.select("#convexhull_graph_visualization").remove();
            var container = document.getElementById("convexhull_tree_visualization_container");
            var svgContainer = document.createElement("DIV");
            svgContainer.id = "convexhull_tree_visualization";
            container.appendChild(svgContainer);
            // Refresh Graph
            container = document.getElementById("convexhull_graph_visualization_container");
            svgContainer = document.createElement("DIV");
            svgContainer.id = "convexhull_graph_visualization";
            container.appendChild(svgContainer);

            createConvexHullVisualization("#convexhull_tree_visualization",
                ConvexHullOntologySelected === 1 ? treeGeneralConvexData : treeExpertConvexData,
                "Tree")
            createConvexHullVisualization("#convexhull_graph_visualization",
                ConvexHullOntologySelected === 1 ? graphGeneralConvexData : graphExpertConvexData,
                "Graph")
        }

        function createConvexHullVisualization(targetElement, targetData, title) {
            var margin = {
                    top: 50,
                    right: 0,
                    bottom: 35,
                    left: 62
                },
                width = 450,
                height = 450;
            var svg = d3.select(targetElement)
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

            // Add X axis
            var x = d3.scaleLinear()
                .domain([0, 1400])
                .range([0, width]);
            svg.append("g")
                .attr("transform", "translate(" + 0 + "," + (height) + ")")
                .attr("color", "white")
                .call(d3.axisBottom(x));

            // Add Y axis
            var y = d3.scaleLinear()
                .domain([1200, 0])
                .range([height, 0]);
            svg.append("g")
                .call(d3.axisLeft(y));

            svg.append("text")
                .attr("x", (width / 2))
                .attr("y", 0 - (margin.top / 2) + 10)
                .attr("text-anchor", "middle")
                .style("font-size", "50px")
                .text(title);
            var counter = 0;
            targetData.forEach((participantFixationData) => {
                var currentColor = '#FF0000'
                var plot = [];
                participantFixationData.forEach((element) => {
                    plot.push({
                        x: parseInt(element.ScreenX, 10),
                        y: parseInt(element.ScreenY, 10),
                    })
                })
                svg.selectAll("polygon" + counter)
                    .data([plot])
                    .enter().append("polygon")
                    .style("fill", function (d) {
                        return currentColor;
                    })
                    .attr("fill-opacity", "0.8")
                    .attr("points", function (d) {
                        return d.map(function (d) {
                            return [x(d.x), y(d.y)].join(",");
                        }).join(" ");
                    });
                counter++;
            })

        }
    </script>



</body>

</html>


<!-- Styling for the page -->
<style>
    html {
        background-image: linear-gradient(#a5c0ee, #fbc5ec);
    }

    heatmapSection {
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-template-rows: auto auto;
        grid-auto-flow: row;
        width: 1600px;
        height: 1200px;
    }


    .img {
        position: absolute;
    }

    .columns,
    .column {
        margin-bottom: 0 !important;
        padding-bottom: 0 !important;
    }

    .tile_canvas {
        width: 550px !important;
        height: 300px !important;
        padding-left: 0;
        padding-right: 0;
        margin-left: auto;
        margin-right: auto;
        display: block;
    }

    .space {

        margin: 1% 1% 1% 1%;
    }

    .juicy {
        background-color: #603F83FF;
        color: #FFFFFF;
    }

    .dark {
        background-color: #3d3d3d;
    }

    /* Context Menu CSS */
    .context-menu {
        padding: 5% 5% 5% 5%;
    }

    .menu * {
        color: #ffffff !important;
    }

    .start {
        display: block;
    }

    .default {
        display: none;
    }

    .top-spacing {
        margin-top: 2%;
    }

    /* Session Comparison Overview CSS */
    .button_selected {
        background-color: #603F83FF;
        color: #FFFFFF;
    }

    /* Time Comparison CSS */
    .comparison_canvas {
        width: 1000px;
    }

    .selector_label {
        font-size: 20px;
        font-weight: bolder;
        padding: 1% 1% 1% 1%;
    }

    .comparison_button_selected {
        background-color: #603F83FF;
        color: #FFFFFF;
    }

    /* slider styles */
    .slidecontainer {
    width: 100%; /* Width of the outside container */
    }

    /* The slider itself */
    .slider {
    -webkit-appearance: none;  /* Override default CSS styles */
    appearance: none;
    width: 80%; /* Full-width */
    height: 25px; /* Specified height */
    background: #d2d2d2; /* Grey background */
    outline: none; /* Remove outline */
    opacity: 0.7; /* Set transparency (for mouse-over effects on hover) */
    -webkit-transition: .2s; /* 0.2 seconds transition on hover */
    transition: opacity .2s;
    }

    /* Mouse-over effects */
    .slider:hover {
    opacity: 1; /* Fully shown on mouse-over */
    }

    /* The slider handle (use -webkit- (Chrome, Opera, Safari, Edge) and -moz- (Firefox) to override default look) */
    .slider::-webkit-slider-thumb {
    -webkit-appearance: none; /* Override default look */
    appearance: none;
    width: 25px; /* Set a specific slider handle width */
    height: 25px; /* Slider handle height */
    background: #603F83FF; /* Green background */
    cursor: pointer; /* Cursor on hover */
    }

    .slider::-moz-range-thumb {
    width: 25px; /* Set a specific slider handle width */
    height: 25px; /* Slider handle height */
    background: #603F83FF; /* Green background */
    cursor: pointer; /* Cursor on hover */
    }

    /* hover styles */
    .tooltip { 
        position:absolute; 
        left:0; 
        top:0; 
        background:rgba(0,0,0,.8); 
        color:white; 
        font-size:14px; 
        /* padding:5px;  */
        line-height:18px; 
        display:none;
    }
    #treeHeatmap {
         position:relative;
    }
    .subtitle{
        font-size: 20px;
        font-weight: bolder;
    }


    /*Convex Hull CSS */
    polygon {
        opacity: .3;
    }

    text {
        color: #FFFFFF !important;
        fill: #FFFFFF;
    }
</style>